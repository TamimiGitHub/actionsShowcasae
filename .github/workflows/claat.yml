name: Claat Export
on:
  push:
    paths:
      - markdown/**

jobs:
  Claat-Export:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.20.5'
      
      - name: Checkout Current Branch
        uses: actions/checkout@master
        with:
          path: main

      - name: Checkout claat repo
        uses: actions/checkout@v2
        with:
          repository: SolaceDev/google-tools
          path: google-tools
      
      - name: Build claat
        run: cd google-tools/claat; go build .
      
      - name: Update PATH
        run: cd google-tools/claat; export PATH=$PATH:$pwd
    
      - name: Get all changed markdown files
        id: changed-markdown-files
        uses: tj-actions/changed-files@v40
        with:
          files: |
             **.md
        
      - name: Export markdown files
        run: |
          for file in ${{ steps.changed-markdown-files.outputs.all_changed_files }}; do
            google-tools/claat/claat export ../../codelabs/ $file
          done

      - name: list files in codelabs
        run: ls main/codelabs
